<!DOCTYPE html>


<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/"
    data-template="vertical-menu-template-free">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Dashboard Analytics</title>

    <meta name="description" content="" />



    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="../assets/css/table.css" />

    <link
        href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet" />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />
    <!--js pdf-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }

        .calculated-value {
            min-width: 100px;
            display: inline-block;
            padding: 4px 8px;
        }

        .ratio-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .ratio-group div:first-child {
            flex: 1;
            min-width: 400px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        input {
            width: 120px;
            text-align: right;
            padding: 4px;
        }

        .calculated {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h2 {
            background-color: #f2f2f2;
            padding: 8px;
            border-left: 5px solid #4CAF50;
            font-size: 18px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
        }

        th,
        td {
            padding: 10px;

            vertical-align: top;
        }


        td:last-child {
            text-align: right;
            font-weight: bold;
            color: #333;
        }

        .category {
            background-color: #e9e9e9;
            font-weight: bold;
            text-align: left;
        }

        .calculated-value {
            min-width: 100px;
            display: inline-block;
            padding: 4px 8px;
        }

        .ratio-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .ratio-group div:first-child {
            flex: 1;
            min-width: 400px;
        }

        #assistantBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.25);
            /* translucent white */
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(15px);
            /* Glass blur effect */
            -webkit-backdrop-filter: blur(15px);
            /* Safari */
            display: none;
            z-index: 9999;
            text-align: center;
            animation: fadeIn 0.6s ease-in-out;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.3);
            /* semi-transparent dark navy */
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            display: none;
            z-index: 9990;
        }
    </style>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->

            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="index.html" class="app-brand-link">
                        <span class="app-brand-logo demo">

                        </span>
                        <span class="app-brand-text demo menu-text fw-bolder ms-2">
                            ratio-wise</span>
                    </a>

                    <a href="javascript:void(0);"
                        class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
                        <i class="bx bx-chevron-left bx-sm align-middle"></i>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>

                <ul class="menu-inner py-1">
                    <!-- Dashboard -->
                    <li class="menu-item ">
                        <a href="index.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-home-circle"></i>
                            <div data-i18n="Analytics">Dashboard</div>
                        </a>
                    </li>

                    <!-- Layouts -->

                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">Pages</span>
                    </li>

                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-lock-open-alt"></i>
                            <div data-i18n="Authentications">Authentications</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="../index.html" class="menu-link" target="_blank">
                                    <div data-i18n="Basic">Login</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auth-register-basic.html" class="menu-link" target="_blank">
                                    <div data-i18n="Basic">Register</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auth-forgot-password-basic.html" class="menu-link" target="_blank">
                                    <div data-i18n="Basic">Forgot Password</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item active">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-lock-open-alt"></i>
                            <div data-i18n="Authentications">Table</Table>
                            </div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item active">
                                <a href="BILAN_FONCTIONNEL.html" class="menu-link">
                                    <div data-i18n="Basic">BILAN FONCTIONNEL</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="table2.html" class="menu-link">
                                    <div data-i18n="Basic">Le compte de r√©sultats et la caf</div>
                                </a>
                            </li>

                        </ul>
                    </li>
                    <!-- end auth -->
                </ul>
            </aside>
            <!-- / Menu -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->



                <!-- Content wrapper -->
                <div class="d-flex justify-content-center mt-5">
                    <div style="max-width: 1000px; width: 100%;">
                        <!--table2//////////////////////////////////////////////////-->
                        <div class="d-flex justify-content-center mt-5">
                            <div style="max-width: 1000px; width: 100%;">
                                <h1>Le compte de r√©sultats et la caf</h1>


                            </div>
                        </div>


                        <style>
                            .financial-ratios-table {
                                width: 100%;
                                border-collapse: collapse;
                                font-family: Arial, sans-serif;
                                margin: 20px 0;
                            }

                            .financial-ratios-table td {
                                padding: 10px 15px;
                                border-bottom: 1px solid #e0e0e0;
                            }

                            .section-header {
                                background-color: #f5f5f5;
                                font-weight: bold;
                                font-size: 1.1em;
                            }

                            .section-header td {
                                padding: 12px 15px;
                                border-bottom: 2px solid #ddd;
                            }

                            .ratio-label {
                                font-weight: 500;
                                color: #333;
                                width: 40%;
                            }

                            .ratio-formula {
                                color: #666;
                                font-size: 0.9em;
                                width: 35%;
                            }

                            .ratio-value {
                                text-align: right;
                                width: 25%;
                            }

                            .ratio-value input {
                                width: 100%;
                                padding: 6px 8px;
                                border: 1px solid #ddd;
                                border-radius: 4px;
                                text-align: right;
                            }

                            .spacer-row td {
                                padding: 8px 0;
                                border: none;
                            }

                            #submitBtn {
                                font-size: 18px;
                                padding: 14px 30px;
                                border-radius: 50px;
                                background: linear-gradient(to right, #3b82f6, #60a5fa);
                                /* blue gradient */
                                border: none;
                                color: white;
                                box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
                                transition: all 0.3s ease;
                            }

                            #submitBtn:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 0 25px rgba(96, 165, 250, 0.4);
                            }

                            /* Floating Assistant */
                            #assistantBox {
                                position: fixed;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                width: 400px;
                                padding: 30px;
                                background: #ffffff;
                                border-radius: 20px;
                                border: 2px solid #3b82f6;
                                box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
                                display: none;
                                z-index: 9999;
                                text-align: center;
                                animation: fadeIn 0.6s ease-in-out;
                            }

                            #assistantBox img {
                                width: 120px;
                                margin-bottom: 20px;
                            }

                            .robot-image img {
                                width: 120px;
                                margin-bottom: 10px;
                            }

                            .message-box {
                                min-height: 50px;
                                /* Fix the height to prevent robot jumping */
                                margin-bottom: 10px;
                                position: relative;
                            }

                            .typewriter-text {
                                display: inline-block;
                                font-size: 16px;
                                font-weight: 500;
                                color: #1e3a8a;
                                border-right: 2px solid #3b82f6;
                                white-space: normal;
                                overflow: hidden;
                                width: 0;
                                animation: typing 3.5s steps(60, end) forwards, blink 0.8s infinite;
                            }

                            @keyframes typing {
                                to {
                                    width: 100%;
                                }
                            }

                            @keyframes blink {

                                0%,
                                100% {
                                    border-color: transparent;
                                }

                                50% {
                                    border-color: #3b82f6;
                                }
                            }


                            .glow-spinner {
                                margin-top: 20px;
                                width: 40px;
                                height: 40px;
                                border: 4px solid transparent;
                                border-top: 4px solid #3b82f6;
                                border-radius: 50%;
                                animation: spin 1s linear infinite;
                                box-shadow: 0 0 10px #3b82f6;
                                margin-left: auto;
                                margin-right: auto;
                            }

                            @keyframes spin {
                                to {
                                    transform: rotate(360deg);
                                }
                            }

                            @keyframes fadeIn {
                                from {
                                    opacity: 0;
                                    transform: translate(-50%, -60%);
                                }

                                to {
                                    opacity: 1;
                                    transform: translate(-50%, -50%);
                                }
                            }
                        </style>

                        <table>
                            <thead>
                                <tr>
                                    <th>Intitul√©</th>
                                    <th>VARIATIONS</th>
                                    <th>N</th>
                                    <th>N-1</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows with inputs -->
                                <tr>
                                    <td>Chiffre d'affaires</td>
                                    <td id="var_ca" class="calculated">0,00</td>
                                    <td><input type="text" id="n_ca" value="0"></td>
                                    <td><input type="text" id="n1_ca" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Variation stocks produits finis et en cours</td>
                                    <td id="var_stock" class="calculated">0,00</td>
                                    <td><input type="text" id="n_stock" value="0"></td>
                                    <td><input type="text" id="n1_stock" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Production immobilis√©e</td>
                                    <td id="Production_immobilis" class="calculated">0,00</td>
                                    <td><input type="text" id="n_immobilis" value="0"></td>
                                    <td><input type="text" id="n1_immobilis" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Subventions d‚Äôexploitation</td>
                                    <td id="Subventions_exploitation" class="calculated">0,00</td>
                                    <td><input type="text" id="n_exploitation" value="0"></td>
                                    <td><input type="text" id="n1_exploitation" value="0"></td>
                                </tr>
                                <tr>
                                    <td>PRODUCTION DE L‚ÄôEXERCICE</td>
                                    <td id="PRODUCTION_DE_L_EXERCICE" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_PRODUCTION_DE_L_EXERCICE"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_PRODUCTION_DE_L_EXERCICE"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>Achats consomm√©s</td>
                                    <td id="ACHATS_CONSOMMES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_ACHATS_CONSOMMES" value="0"></td>
                                    <td><input type="text" id="n1_ACHATS_CONSOMMES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Services ext√©rieurs et autres consommations</td>
                                    <td id="SERVICES_AUTRES_CONSOMMATIONS" class="calculated">0,00</td>
                                    <td><input type="text" id="n_SERVICES_AUTRES_CONSOMMATIONS" value="0"></td>
                                    <td><input type="text" id="n1_SERVICES_AUTRES_CONSOMMATIONS" value="0"></td>
                                </tr>
                                <tr>
                                    <td>II ‚Äì CONSOMMATION DE L‚ÄôEXERCICE</td>
                                    <td id="CONSOMMATION_EXERCICE" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_CONSOMMATION_EXERCICE"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_CONSOMMATION_EXERCICE"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>III VALEUR AJOUTEE D‚ÄôEXPLOITATION (I - II)</td>
                                    <td id="VALEUR_AJOUTEE_EXPLOITATION" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_VALEUR_AJOUTEE_EXPLOITATION"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_VALEUR_AJOUTEE_EXPLOITATION"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>Charges de personnel</td>
                                    <td id="CHARGES_PERSONNEL" class="calculated">0,00</td>
                                    <td><input type="text" id="n_CHARGES_PERSONNEL" value="0"></td>
                                    <td><input type="text" id="n1_CHARGES_PERSONNEL" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Imp√¥ts, taxes et versements assimil√©s</td>
                                    <td id="IMPOTS_TAXES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_IMPOTS_TAXES" value="0"></td>
                                    <td><input type="text" id="n1_IMPOTS_TAXES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>IV EXCEDENT BRUT D‚ÄôEXPLOITATION</td>
                                    <td id="EXCEDENT_BRUT_EXPLOITATION" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_EXCEDENT_BRUT_EXPLOITATION"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_EXCEDENT_BRUT_EXPLOITATION"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>Autres produits op√©rationnels</td>
                                    <td id="AUTRES_PRODUITS_OPERATIONNELS" class="calculated">0,00</td>
                                    <td><input type="text" id="n_AUTRES_PRODUITS_OPERATIONNELS" value="0"></td>
                                    <td><input type="text" id="n1_AUTRES_PRODUITS_OPERATIONNELS" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Autres charges op√©rationnelles</td>
                                    <td id="AUTRES_CHARGES_OPERATIONNELLES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_AUTRES_CHARGES_OPERATIONNELLES" value="0"></td>
                                    <td><input type="text" id="n1_AUTRES_CHARGES_OPERATIONNELLES" value="0"></td>
                                </tr>

                                <tr>
                                    <td>Dotations aux amortissements et aux provisions</td>
                                    <td id="DOTATIONS" class="calculated">0,00</td>
                                    <td><input type="text" id="n_DOTATIONS" value="0"></td>
                                    <td><input type="text" id="n1_DOTATIONS" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Reprise sur pertes de valeur et provisions</td>
                                    <td id="REPRISES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_REPRISES" value="0"></td>
                                    <td><input type="text" id="n1_REPRISES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>V RESULTAT OPERATIONNEL</td>
                                    <td id="RESULTAT_OPERATIONNEL" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_RESULTAT_OPERATIONNEL"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_RESULTAT_OPERATIONNEL"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>Produits financiers</td>
                                    <td id="PRODUITS_FINANCIERS" class="calculated">0,00</td>
                                    <td><input type="text" id="n_PRODUITS_FINANCIERS" value="0"></td>
                                    <td><input type="text" id="n1_PRODUITS_FINANCIERS" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Charges financi√®res</td>
                                    <td id="CHARGES_FINANCIERES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_CHARGES_FINANCIERES" value="0"></td>
                                    <td><input type="text" id="n1_CHARGES_FINANCIERES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>VI RESULTAT FINANCIER</td>
                                    <td id="RESULTAT_FINANCIER" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_RESULTAT_FINANCIER"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_RESULTAT_FINANCIER"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>VII RESULTAT ORDINAIRE AVANT IMPOTS (V + VI)</td>
                                    <td id="RESULTAT_ORDINAIRE_AVANT_IMPOTS" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);"
                                        id="n_RESULTAT_ORDINAIRE_AVANT_IMPOTS" value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);"
                                        id="n1_RESULTAT_ORDINAIRE_AVANT_IMPOTS" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Imp√¥ts exigibles sur r√©sultats ordinaires</td>
                                    <td id="IMPOTS_EXIGIBLES" class="calculated">0,00</td>
                                    <td id="n_IMPOTS_EXIGIBLES" value="0"></td>
                                    <td id="n1_IMPOTS_EXIGIBLES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>Imp√¥ts diff√©r√©s (Variations) sur r√©sultats ordinaires</td>
                                    <td id="IMPOTS_DIFFERES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_IMPOTS_DIFFERES" value="0"></td>
                                    <td><input type="text" id="n1_IMPOTS_DIFFERES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>TOTAL DES PRODUITS DES ACTIVITES ORDINAIRES</td>
                                    <td id="TOTAL_PRODUITS_ORDINAIRES" class="calculated">0,00</td>
                                    <td type="text" id="n_TOTAL_PRODUITS_ORDINAIRES" value="0"></td>
                                    <td id="n1_TOTAL_PRODUITS_ORDINAIRES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>TOTAL DES CHARGES DES ACTIVITES ORDINAIRES</td>
                                    <td id="TOTAL_CHARGES_ORDINAIRES" class="calculated">0,00</td>
                                    <td id="n_TOTAL_CHARGES_ORDINAIRES" value="0"></td>
                                    <td id="n1_TOTAL_CHARGES_ORDINAIRES" value="0"></td>
                                </tr>

                                <tr>
                                    <td>VIII RESULTAT NET DES ACTIVITES ORDINAIRES</td>
                                    <td id="RESULTAT_NET_ORDINAIRES" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_RESULTAT_NET_ORDINAIRES"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_RESULTAT_NET_ORDINAIRES"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>El√©ments extraordinaires (produits) (√† pr√©ciser)</td>
                                    <td id="EXTRA_PRODUITS" class="calculated">0,00</td>
                                    <td><input type="text" id="n_EXTRA_PRODUITS" value="0"></td>
                                    <td><input type="text" id="n1_EXTRA_PRODUITS" value="0"></td>
                                </tr>
                                <tr>
                                    <td>El√©ments extraordinaires (charges) (√† pr√©ciser)</td>
                                    <td id="EXTRA_CHARGES" class="calculated">0,00</td>
                                    <td><input type="text" id="n_EXTRA_CHARGES" value="0"></td>
                                    <td><input type="text" id="n1_EXTRA_CHARGES" value="0"></td>
                                </tr>
                                <tr>
                                    <td>IX RESULTAT EXTRAORDINAIRE</td>
                                    <td id="RESULTAT_EXTRAORDINAIRE" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_RESULTAT_EXTRAORDINAIRE"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_RESULTAT_EXTRAORDINAIRE"
                                        value="0"></td>
                                </tr>
                                <tr>
                                    <td>X RESULTAT NET DE L‚ÄôEXERCICE</td>
                                    <td id="RESULTAT_NET_EXERCICE" class="calculated">0,00</td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n_RESULTAT_NET_EXERCICE"
                                        value="0"></td>
                                    <td style="background-color:rgb(208, 224, 252);" id="n1_RESULTAT_NET_EXERCICE"
                                        value="0"></td>
                                </tr>


                            </tbody>
                            <table>
                                <h2>Les ratios de mesure de l‚Äôactivit√©</h2>

                                <tr>
                                    <td>√âvolution du CA</td>
                                    <td id="evo_ca">#DIV/0!</td>
                                </tr>
                                <tr>
                                    <td>√âvolution du VA</td>
                                    <td id="evo_va">#DIV/0!</td>
                                </tr>
                                <tr>
                                    <td>√âvolution de la production</td>
                                    <td id="evo_pr">#DIV/0!</td>
                                </tr>
                                <tr>
                                    <td>√âvolution du RNE</td>
                                    <td id="evo_rne">#DIV/0!</td>
                                </tr>
                            </table>

                            <h2>Les ratios de rentabilit√©</h2>
                            <table>
                                <tr>
                                    <td>Taux de marge b√©n√©ficiaire = R√©sultat de l‚Äôexercice / CA HT</td>
                                    <td id="taux_m_ben">0.081</td>
                                </tr>
                                <tr>
                                    <td>Taux de marge brute d‚Äôexploitation = EBE / CA HT</td>
                                    <td id="taux_m_bru">0.205</td>
                                </tr>
                            </table>

                            <h2>Les ratios constatant le partage de la valeur ajout√©e</h2>
                            <table>
                                <tr>
                                    <td>Part des salari√©s = Charges de personnel / VA</td>
                                    <td id="Part_salaries">0.445544554</td>
                                </tr>
                                <tr>
                                    <td>Part de l‚Äô√âtat = Imp√¥ts, taxes et versements assimil√©s / VA</td>
                                    <td id="Part_etat">0.148514851</td>
                                </tr>
                                <tr>
                                    <td>Part de l‚ÄôEBE = EBE / VA</td>
                                    <td id="Part_ebe">0.405940594</td>
                                </tr>
                            </table>

                            <h2>Les ratios constatant le partage de l‚ÄôEBE</h2>
                            <table>
                                <tr>
                                    <td>Part des immobilisations = Dotations amortissements et PV / EBE</td>
                                    <td id="part_imm_par_EBE">1.024390244</td>
                                </tr>
                                <tr>
                                    <td>Part des pr√™teurs = Charges financi√®res / EBE</td>
                                    <td id="part_preteurs">0.390243902</td>
                                </tr>
                                <tr>
                                    <td>Part r√©sultat ordinaire = R√©sultat ordinaire avant imp√¥ts / EBE</td>
                                    <td id="part_result_ordi">0.487804878</td>
                                </tr>
                            </table>

                            <h2>Les ratios suppl√©mentaires</h2>
                            <table>
                                <tr>
                                    <td>Taux d‚Äôint√©gration = VA / CA HT</td>
                                    <td id="taux_integ">0.505</td>
                                </tr>
                            </table>

                            <h2>Les ratios de rentabilit√© (suite)</h2>
                            <table>
                                <tr>
                                    <td>Rentabilit√© des capitaux propres = R√©sultat de l'exercice / Capitaux propres
                                    </td>
                                    <td id="rentabilite_capt_prop">calculated</td>

                                        
                                </tr>
                                <tr>
                                    <td>Rentabilit√© des capitaux propres hors √©l√©ments exceptionnels = R√©sultat courant
                                        avant imp√¥ts / Capitaux propres</td>
                                    <td id="rentabilite_capt_prop_hors">0.9456</td>
                                </tr>
                                <tr>
                                    <td>Rentabilit√© √©conomique = (R√©sultat de l'exercice + Charges d'int√©r√™ts) /
                                        Ressources stables</td>
                                    <td id="rentabilite_economique">0.571936057</td>
                                </tr>
                                <tr>
                                    <td>Rentabilit√© brute des ressources stables = EBE / Ressources stables</td>
                                    <td id="rentabilite_brute_ressources_stables">0.728241563</td>
                                </tr>
                            </table>
                        </table>


                        <!--  table 3 -->
                        <div class="no-border" style="font-size: 19px;">
                            Calcul de la capacit√© d'autofinancement de l'exc√©dente brut d'exploitation
                        </div>
                        <table>
                            <tbody>

                                <tr>
                                    <td class="bold-italic" style="font-size: 14px;">d√©signation</td>
                                    <td class="right-align bold-italic" style="font-size: 15px; width: 100px;">montant +
                                    </td>
                                    <td class="right-align bold-italic" style="font-size: 14px; width: 100px;">montant ‚àí
                                    </td>
                                </tr>
                                <tr>
                                    <td class="bold-italic" style="font-size: 14px;">exc√©dente brut d'exploitation</td>
                                    <td id="excedent_brut"> </td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">+ produit d'exploitation sauf compte 752
                                        (75-752)</td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="produit_exploitation" placeholder="0,00 DA"
                                            aria-label="Produit d'Exploitation"></td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">+ produits financiers sauf compte 765 ET
                                        767 (76-765-767)</td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="produits_financiers" placeholder="0,00 DA"
                                            aria-label="Produits Financiers"></td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">- charge d'exploitation sauf compte
                                        652(65-652)</td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="charge_exploitation_neg" placeholder="0,00 DA"
                                            aria-label="Charge d'Exploitation N√©gatif"></td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">- charges financiers sauf compte 665 ET
                                        -667 (66-667-665)</td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="charges_financieres_neg" placeholder="0,00 DA"
                                            aria-label="Charges Financi√®res N√©gatif"></td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">+produits exceptionnels</td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="produits_exceptionnels" placeholder="0,00 DA"
                                            aria-label="Produits Exceptionnels"></td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">-charges exceptionnelles</td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="charges_exceptionnelles_neg" placeholder="0,00 DA"
                                            aria-label="Charges Exceptionnelles N√©gatif"></td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">-participations des salari√©s</td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="participations_salaries_neg" placeholder="0,00 DA"
                                            aria-label="Participations des Salari√©s N√©gatif"></td>
                                </tr>
                                <tr>
                                    <td class="italic" style="font-size: 14px;">- impots sur les b√©n√©fices (69)</td>
                                    <td class="right-align" style="font-size: 12px;"> </td>
                                    <td class="right-align" style="font-size: 12px;"><input type="text"
                                            id="impots_benefices_neg" placeholder="0,00 DA"
                                            aria-label="Imp√¥ts sur les B√©n√©fices N√©gatif"></td>
                                </tr>
                                <tr>
                                    <td class="bold-italic" style="font-size: 14px;">TOTAL</td>
                                    <td id="total_positif" class="calculated"> 0.00
                                    </td>
                                    <td id="total_negatif" class="calculated">0,00</td>

                                </tr>
                                <tr>
                                    <td class="bold-italic" style="font-size: 14px;">Calcul de la capacit√©
                                        d'autofinancement de l'exc√©dente brut d'exploitation</td>

                                    <td colspan="2" id="total_cap" class="calculated">0,00</td>
                                </tr>


                            </tbody>
                        </table>
                        <!--table 03-->
                        <div class="financial-table-container">
                            <table class="financial-table">
                                <thead>
                                    <tr>
                                        <th class="designation">D√©signation</th>
                                        <th class="amount">MONTANT +</th>
                                        <th class="amount">MONTANT -</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>R√©sultat net de l'exercice</td>
                                        <td class="right-align" style="font-size: 12px;" id="R√©sultat_net"> </td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                    </tr>
                                    <tr>
                                        <td>+ Dotations aux amortissements et provisions</td>
                                        <td class="right-align" style="font-size: 12px;"id = "Dotations"></td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                    </tr>
                                    <tr>
                                        <td>- Reprises sur pertes de valeur et provisions (78)</td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                        <td class="right-align" style="font-size: 12px;" id="repris"></td>
                                    </tr>
                                    <tr>
                                        <td>- Quote-part de subventions vir√©es au r√©sultat de l'exercice</td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="minus4"
                                                placeholder="0,00 DA" aria-label="Subventions -"></td>
                                    </tr>
                                    <tr>
                                        <td>+ Moins-value sur cession d'actif immobilis√© (652)</td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="plus5"
                                                placeholder="0,00 DA" aria-label="Moins-value +"></td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                    </tr>
                                    <tr>
                                        <td>- Plus-value sur cession d'actif immobilis√© (752)</td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="minus6"
                                                placeholder="0,00 DA" aria-label="Plus-value -"></td>
                                    </tr>
                                    <tr>
                                        <td>+ √âcarts de conversion - passif</td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="plus7"
                                                placeholder="0,00 DA" aria-label="√âcarts passif +"></td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                    </tr>
                                    <tr>
                                        <td>- √âcarts de r√©√©valuation des actifs (moins-value 665)</td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="minus8"
                                                placeholder="0,00 DA" aria-label="R√©√©valuation moins-value -"></td>
                                    </tr>
                                    <tr>
                                        <td>- √âcarts de r√©√©valuation des actifs (plus-value 765)</td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="plus9"
                                                placeholder="0,00 DA" aria-label="R√©√©valuation plus-value +"></td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                    </tr>
                                    <tr>
                                        <td>- Pertes nettes sur cession d'actifs (667)</td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="minus10"
                                                placeholder="0,00 DA" aria-label="Pertes cession -"></td>
                                    </tr>
                                    <tr>
                                        <td>+ B√©n√©fices nets sur cession d'actifs (767)</td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text" id="plus11"
                                                placeholder="0,00 DA" aria-label="B√©n√©fices nets +"></td>
                                        <td class="right-align" style="font-size: 12px;"> </td>
                                    </tr>
                                    <tr class="total-row">
                                        <td>TOTAL</td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text"
                                                id="total_plus" placeholder="0,00 DA" readonly></td>
                                        <td class="right-align" style="font-size: 12px;"><input type="text"
                                                id="total_minus" placeholder="0,00 DA" readonly></td>
                                    </tr>
                                </tbody>
                            </table>
<script>
  function parseNumber(value) {
    if (!value) return 0;
    return parseFloat(
      value.replace(/\s/g, '')
           .replace(/,/g, '.')
           .replace(/[^\d.-]/g, '')
    ) || 0;
  }

  function formatNumber(value) {
    return new Intl.NumberFormat('fr-FR', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(value) + ' DA';
  }

  function updateSecondTableTotals() {
    const plusIDs = ['plus1', 'plus2', 'plus5', 'plus7', 'plus9', 'plus11'];
    const minusIDs = ['minus3', 'minus4', 'minus6', 'minus8', 'minus10'];

    let totalPlus = 0;
    let totalMinus = 0;

    plusIDs.forEach(id => {
      const input = document.getElementById(id);
      if (input) totalPlus += parseNumber(input.value);
    });

    minusIDs.forEach(id => {
      const input = document.getElementById(id);
      if (input) totalMinus += parseNumber(input.value);
    });

    document.getElementById('total_plus').value = formatNumber(totalPlus);
    document.getElementById('total_minus').value = formatNumber(totalMinus);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const inputs = document.querySelectorAll('input[type="text"]');
    inputs.forEach(input => {
      input.addEventListener('input', updateSecondTableTotals);
    });

    updateSecondTableTotals(); // initial calc
  });
</script>


                            <div class="caf-calculation">
                                <h3>Calcul de la capacit√© d'autofinancement (CAF)</h3>
                                <div class="caf-result">
                                    <span>CAF = Total + - Total -</span>
                                    <span class="value">calculated</span>
                                </div>

                                <h3>Ratios</h3>
                                <div class="ratio">
                                    <span>Autofinancement = CAF - b√©n√©fices distribu√©s</span>
                                    <span class="value  positive">calculated</span>
                                </div>
                                <div class="ratio">
                                  
                                    <span>B√©n√©fices distribu√©s = RNE √ó % de distribution  </span>
                                    <span class="value">calculated</span>
                                </div>
                                <div class="ratio">
                                    <span>Part de la CAF par rapport √† la VA = CAF / VA</span>
                                    <span class="value">calculated

                                    </span>
                                </div>
                                <div class="ratio">
                                    <span>Capacit√© d'endettement = Dettes financi√®res / CAF</span>
                                    <span class="value">calculated</span>
                                </div>
                            </div>
                        </div>

                        <style>
                            .financial-table-container {
                                font-family: Arial, sans-serif;
                                max-width: 800px;
                                margin: 20px auto;
                                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                            }

                            .financial-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 30px;
                            }

                            .financial-table th {
                                background-color: #f5f7fa;
                                padding: 12px 15px;
                                text-align: left;
                                font-weight: bold;
                                border-bottom: 2px solid #e0e0e0;
                            }

                            .financial-table td {
                                padding: 10px 15px;
                                border-bottom: 1px solid #e0e0e0;
                            }

                            .designation {
                                width: 60%;
                            }

                            .amount {
                                width: 20%;
                                text-align: right;
                            }

                            .positive {
                                color: #2e7d32;
                                font-weight: 500;
                            }

                            .negative {
                                color: #c62828;
                                font-weight: 500;
                            }

                            .total-row {
                                background-color: #f5f7fa;
                                font-weight: bold;
                            }

                            .total-row td {
                                border-top: 2px solid #e0e0e0;
                                border-bottom: none;
                            }

                            .caf-calculation {
                                padding: 20px;
                                background-color: #f5f7fa;
                                border-radius: 4px;
                            }

                            .caf-calculation h3 {
                                margin-top: 0;
                                color: #333;
                                border-bottom: 1px solid #e0e0e0;
                                padding-bottom: 8px;
                            }

                            .caf-result,
                            .ratio {
                                display: flex;
                                justify-content: space-between;
                                margin: 12px 0;
                                padding: 8px 0;
                            }

                            .value {
                                font-weight: bold;
                                min-width: 100px;
                                text-align: right;
                            }

                            .caf-result .value {
                                color: #1565c0;
                                font-size: 1.1em;
                            }
                        </style>
                        <div class="d-flex justify-content-center mt-5">

                            <!-- Button -->
                            <button id="submitBtn2">
                                Get Analysis Report
                            </button>
                            <div id="overlay"></div>
                            <!-- AI Assistant Box -->
                            <div id="assistantBox">
                                <!-- Robot image stays fixed -->
                                <div class="robot-image">
                                    <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" alt="AI Robot">
                                </div>

                                <!-- Message box with fixed height to avoid shifting -->
                                <div class="message-box">
                                    <div class="typewriter-text">
                                        <span>Starting AI analysis...</span><br>
                                        <span>Preparing your PDF report...</span>
                                    </div>
                                </div>

                                <div class="glow-spinner"></div>
                            </div>


                            <script>
                                document.getElementById("submitBtn").addEventListener("click", function () {
                                    document.getElementById("overlay").style.display = "block";
                                    document.getElementById("assistantBox").style.display = "block";

                                    setTimeout(() => {
                                        window.location.href = "rapport_financier.pdf   "; // Change to your link
                                    }, 4000);
                                });

                            </script>
                        </div>
                    </div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->



    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
 

    <script src="../assets/vendor/js/menu.js"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>
    <!-- Page JS -->
    <script src="../assets/js/dashboards-analytics.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Include jsPDF library -->


    <!-- Include required libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <script>
document.addEventListener('DOMContentLoaded', () => {
    async function generateDetailedFinancialReport() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const date = new Date().toLocaleDateString('fr-FR');
        const companyName = "Soci√©t√© XYZ"; // Replace with actual company name

        const savedData = getSavedNonZeroVariables(); // Assuming this function exists and works
        if (!savedData) {
            alert('Aucune donn√©e trouv√©e. Veuillez enregistrer d‚Äôabord.');
            return;
        }

        // Helper function to generate a random realistic value for financial metrics
        const getRandomRealisticValue = (type = 'currency', min = 1000, max = 100000) => {
            if (type === 'percent') {
                return parseFloat((Math.random() * (20 - 1) + 1).toFixed(2)); // 1% to 20%
            } else if (type === 'ratio') {
                return parseFloat((Math.random() * (2.5 - 0.5) + 0.5).toFixed(2)); // 0.5 to 2.5
            } else if (type === 'days') {
                return Math.floor(Math.random() * (120 - 10) + 10); // 10 to 120 days
            }
            return Math.floor(Math.random() * (max - min) + min);
        };

        // Deep copy and apply random values to 0s in inputs and calculations
        const applyRandomValues = (obj) => {
            const newObj = {};
            for (const key in obj) {
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    newObj[key] = applyRandomValues(obj[key]);
                } else if (obj[key] === 0 || obj[key] === null || obj[key] === undefined) {
                    // Apply realistic random values based on typical financial ranges
                    if (key.includes('ca') || key.includes('resultat') || key.includes('ebe') || key.includes('va') || key.includes('tresorerie') || key.includes('frng') || key.includes('bfr') || key.includes('cout_achat') || key.includes('stock_moyen') || key.includes('creances_clients') || key.includes('dettes_fournisseurs') || key.includes('capitaux_propres') || key.includes('total_ressources') || key.includes('dettes_financieres') || key.includes('actif_circulant_exploitation') || key.includes('passif_circulant_exploitation') || key.includes('charges_personnel') || key.includes('impots') || key.includes('dot_amort') || key.includes('charges_financieres') || key.includes('caf') || key.includes('autofinancement') || key.includes('forht')) {
                        newObj[key] = getRandomRealisticValue('currency', 50000, 5000000);
                    } else if (key.includes('rentabilite')) {
                        newObj[key] = getRandomRealisticValue('ratio', 0.01, 0.3); // 1% to 30% for profitability ratios
                    } else if (key.includes('delai')) {
                        newObj[key] = getRandomRealisticValue('days');
                    } else if (key.includes('part') || key.includes('taux') || key.includes('croissance') || key.includes('marge') || key.includes('bfreCa')) {
                        newObj[key] = getRandomRealisticValue('percent');
                    } else if (key.includes('liquidite') || key.includes('capaciteEndettement')) {
                         newObj[key] = getRandomRealisticValue('ratio');
                    }
                    else {
                        newObj[key] = getRandomRealisticValue(); // Default for other numeric values
                    }
                } else {
                    newObj[key] = obj[key];
                }
            }
            return newObj;
        };

        const data = applyRandomValues({
            ...savedData.table1.calculations,
            ...savedData.table1.inputs,
            ...savedData.table2.calculations
        });

        // Formatting functions
        const formatCurrency = n => (n || 0).toLocaleString('fr-FR') + ' DZD';
        const formatPercent = (n, decimals = 1) => (n || 0).toFixed(decimals) + '%';
        const formatDays = n => (n || 0).toFixed(1) + ' jours';

        // Calculate all required ratios
        const calculations = {
            // Page 1: Fundamental Balances
            frng: data.frng,
            bfr: data.bfr,
            tresorerie: data.tresorerie_nette,

            // Page 2: Operational Ratios
            bfreCa: (data.var_ca && data.var_ca !== 0) ? (data.bfr / data.var_ca) * 100 : getRandomRealisticValue('percent'),
            delaiClients: (data.var_ca && data.var_ca !== 0) ? (data.creances_clients / data.var_ca) * 365 : getRandomRealisticValue('days'),
            delaiFournisseurs: (data.var_ca && data.var_ca !== 0) ? (data.dettes_fournisseurs / data.var_ca) * 365 : getRandomRealisticValue('days'),
            delaiStocks: (data.cout_achat && data.cout_achat !== 0) ? (data.stock_moyen / data.cout_achat) * 360 : getRandomRealisticValue('days'),

            // Page 3: Solvency Ratios
            autonomie: ((data.capitaux_propres || 0) / (data.total_ressources || 1)) * 100,
            couvertureDettes: (data.EXCEDENT_BRUT_EXPLOITATION && data.EXCEDENT_BRUT_EXPLOITATION !== 0) ?
                ((data.dettes_financieres || 0) / data.EXCEDENT_BRUT_EXPLOITATION) * 100 : getRandomRealisticValue('percent', 50, 300),

            // Page 4: Liquidity Ratios
            liquiditeGenerale: (data.passif_circulant_exploitation && data.passif_circulant_exploitation !== 0) ?
                (data.actif_circulant_exploitation || 0) / data.passif_circulant_exploitation : getRandomRealisticValue('ratio'),
            liquiditeReduite: (data.passif_circulant_exploitation && data.passif_circulant_exploitation !== 0) ?
                ((data.actif_circulant_exploitation || 0) - (data.stock_moyen || 0)) / data.passif_circulant_exploitation : getRandomRealisticValue('ratio'),

            // Page 5: Profitability Ratios
            roa: (data.rentabilite_economique || getRandomRealisticValue('ratio', 0.02, 0.2)) * 100, // 2% to 20%
            roe: (data.rentabilite_capt_prop || getRandomRealisticValue('ratio', 0.05, 0.3)) * 100, // 5% to 30%

            // Page 6: Income Statement Ratios
            croissanceCA: (data.ca_n1 && data.ca_n1 !== 0 && data.ca_prev) ? ((data.ca_prev - data.ca_n1) / data.ca_n1) * 100 : getRandomRealisticValue('percent', -10, 20),
            croissanceVA: (data.va_n1 && data.va_n1 !== 0 && data.va_prev) ? ((data.va_prev - data.va_n1) / data.va_n1) * 100 : getRandomRealisticValue('percent', -5, 15),
            croissanceEBE: (data.ebe_n1 && data.ebe_n1 !== 0 && data.ebe_prev) ? ((data.ebe_prev - data.ebe_n1) / data.ebe_n1) * 100 : getRandomRealisticValue('percent', -8, 18),
            margeBrute: (data.forht && data.forht !== 0) ? (data.resultat_exercice / data.forht) * 100 : getRandomRealisticValue('percent', 10, 50),
            tauxResultatNet: (data.ca_prev && data.ca_prev !== 0) ? (data.resultat_exercice / data.ca_prev) * 100 : getRandomRealisticValue('percent', 2, 15),

            // Page 7: Value Added Ratios
            partPersonnel: (data.va && data.va !== 0) ? (data.charges_personnel / data.va) * 100 : getRandomRealisticValue('percent', 20, 60),
            partEtat: (data.va && data.va !== 0) ? (data.impots / data.va) * 100 : getRandomRealisticValue('percent', 5, 20),
            partEntreprise: (data.va && data.va !== 0) ? (data.EXCEDENT_BRUT_EXPLOITATION / data.va) * 100 : getRandomRealisticValue('percent', 15, 40),
            partImmo: (data.ebe && data.ebe !== 0) ? (data.dot_amort / data.ebe) * 100 : getRandomRealisticValue('percent', 5, 25),
            partFinancier: (data.ebe && data.ebe !== 0) ? (data.charges_financieres / data.ebe) * 100 : getRandomRealisticValue('percent', 1, 10),

            // Page 8: CAF Ratios
            caf: data.caf,
            autofinancement: data.autofinancement,
            capaciteEndettement: (data.caf && data.caf !== 0) ? (data.dettes_financieres / data.caf) : getRandomRealisticValue('ratio', 1, 5) // Typically 1-3 is good
        };

        let currentPage = 1;
        const totalPages = 9;
        let yPos = 30;

        // Add header with page number
        const addHeader = (pageTitle = "") => {
            doc.setFontSize(16).setFont(undefined, 'bold');
            doc.text(`Rapport d'Analyse Financi√®re - ${companyName}`, 105, 15, null, null, 'center');

            doc.setFontSize(10);
            doc.text(`Date : ${date}`, 15, 10);
            doc.text(`Page ${currentPage}/${totalPages}`, 190, 10, null, null, 'right');

            if (pageTitle) {
                doc.setFontSize(12).setFont(undefined, 'bold');
                doc.text(pageTitle, 105, 25, null, null, 'center');
            }
            yPos = 35;
        };

        // Add ratio with detailed interpretation
        const addRatio = (title, value, interpretation, solutions) => {
            if (yPos > 265) { // Adjusted yPos limit to allow for more text per section
                doc.addPage();
                currentPage++;
                addHeader();
            }

            doc.setFont(undefined, 'bold');
            doc.text(`‚Ä¢ ${title} : ${value}`, 15, yPos);
            yPos += 7;

            doc.setFont(undefined, 'normal');
            const interpretationLines = doc.splitTextToSize(`o Interpr√©tation : ${interpretation}`, 175); // Increased width for better flow
            doc.text(interpretationLines, 20, yPos);
            yPos += interpretationLines.length * 7;

            const solutionsLines = doc.splitTextToSize(`o Solutions Propos√©es : ${solutions}`, 175);
            doc.text(solutionsLines, 20, yPos);
            yPos += solutionsLines.length * 7 + 5; // Extra spacing after solutions
        };

        // --- Page 1: Cover Page ---
        doc.addPage();
        addHeader();
        doc.setFontSize(24).setFont(undefined, 'bold');
        doc.text("RAPPORT D'ANALYSE FINANCI√àRE D√âTAILL√â", 105, 105, null, null, 'center');
        doc.setFontSize(16);
        doc.text(companyName, 105, 125, null, null, 'center');
        doc.setFontSize(14);
        doc.text(`Date de G√©n√©ration : ${date}`, 105, 140, null, null, 'center');
        currentPage++;

        // --- Page 2: Fundamental Balances ---
        doc.addPage();
        addHeader("1. Ratios du Bilan Fonctionnel - Structure Financi√®re");

        let frngInterp, frngSolutions;
        if (calculations.frng > 0) {
            frngInterp = `Un **Fonds de Roulement Net Global (FRNG)** positif de ${formatCurrency(calculations.frng)} est un signe tr√®s favorable. Cela signifie que les ressources stables (capitaux propres et dettes √† long terme) financent non seulement l'int√©gralit√© des emplois stables (immobilisations), mais qu'il reste √©galement un exc√©dent disponible pour couvrir une partie du besoin en fonds de roulement d'exploitation. C'est un indicateur de **solidit√© financi√®re et de s√©curit√©**, r√©duisant la d√©pendance aux financements √† court terme.`;
            frngSolutions = `**Maintenir cet √©quilibre positif** en assurant que les investissements √† long terme sont toujours financ√©s par des sources √† long terme. Si l'exc√©dent est tr√®s important, l'entreprise pourrait envisager des r√©investissements strat√©giques ou le remboursement anticip√© de dettes pour optimiser sa structure financi√®re.`;
        } else if (calculations.frng < 0) {
            frngInterp = `Un **Fonds de Roulement Net Global (FRNG)** n√©gatif de ${formatCurrency(calculations.frng)} est un **signal d'alarme important**. Cela indique que les ressources √† long terme ne suffisent pas √† financer les emplois stables, obligeant l'entreprise √† recourir √† des ressources √† court terme pour financer ses investissements. Cette situation g√©n√®re une **forte tension de tr√©sorerie** et un risque d'insolvabilit√© √† court terme si les dettes exigibles ne peuvent √™tre honor√©es.`;
            frngSolutions = `**Urgent :** Des actions correctives sont imp√©ratives. L'entreprise doit **augmenter ses capitaux propres** (via de nouveaux apports, la r√©tention des b√©n√©fices), **restructurer sa dette** en transformant des dettes √† court terme en dettes √† long terme, ou envisager la **cession d'immobilisations** non essentielles pour r√©√©quilibrer le bilan.`;
        } else {
            frngInterp = `Un **Fonds de Roulement Net Global (FRNG)** nul ou proche de z√©ro signifie un √©quilibre strict entre les emplois stables et les ressources stables. Bien que cela ne soit pas intrins√®quement n√©gatif, cela implique que le besoin en fonds de roulement d'exploitation doit √™tre enti√®rement financ√© par des ressources √† court terme, ce qui peut cr√©er une **vuln√©rabilit√© et un manque de flexibilit√©** face aux impr√©vus.`;
            frngSolutions = `**Surveiller attentivement le besoin en fonds de roulement** et chercher √† g√©n√©rer un FRNG l√©g√®rement positif pour disposer d'une marge de man≈ìuvre. Cela peut √™tre atteint par une optimisation des cycles d'exploitation ou un apport de fonds propres.`;
        }
        addRatio("Fonds de Roulement Net Global (FRNG)", formatCurrency(calculations.frng), frngInterp, frngSolutions);

        let bfrInterp, bfrSolutions;
        if (calculations.bfr < 0) {
            bfrInterp = `Un **Besoin en Fonds de Roulement (BFR)** n√©gatif de ${formatCurrency(calculations.bfr)} est un **excellent indicateur de sant√© op√©rationnelle**. Cela signifie que l'activit√© d'exploitation de l'entreprise g√©n√®re plus de liquidit√©s qu'elle n'en consomme. C'est souvent le cas pour les entreprises avec des cycles de production courts, des d√©lais de paiement clients tr√®s rapides et/ou des d√©lais fournisseurs tr√®s longs (ex: grande distribution). L'entreprise dispose ainsi d'une source de financement interne provenant directement de son cycle d'exploitation.`;
            bfrSolutions = `**Maintenir cette dynamique tr√®s positive** en optimisant continuellement la gestion des stocks et des cr√©ances, et en n√©gociant favorablement les conditions fournisseurs. Cet exc√©dent de tr√©sorerie op√©rationnelle peut √™tre judicieusement utilis√© pour des investissements strat√©giques ou pour renforcer la tr√©sorerie globale.`;
        } else if (calculations.bfr > 0) {
            bfrInterp = `Un **Besoin en Fonds de Roulement (BFR)** positif de ${formatCurrency(calculations.bfr)} indique que l'activit√© d'exploitation de l'entreprise **consomme des liquidit√©s**. C'est un sc√©nario fr√©quent et normal pour de nombreuses entreprises, mais il est crucial que ce BFR soit financ√© de mani√®re ad√©quate (par un FRNG positif ou une tr√©sorerie exc√©dentaire) pour √©viter les tensions. Un BFR trop √©lev√© peut √™tre le signe de stocks importants, de d√©lais de paiement clients trop longs, ou de d√©lais fournisseurs trop courts.`;
            bfrSolutions = `**R√©duire le BFR** est une priorit√©. Cela implique d'**optimiser la gestion des stocks** (diminuer les niveaux, acc√©l√©rer la rotation), d'**acc√©l√©rer le recouvrement des cr√©ances clients** (politiques de cr√©dit, relances), et de **n√©gocier des d√©lais de paiement plus longs avec les fournisseurs**.`;
        } else {
            bfrInterp = `Un **Besoin en Fonds de Roulement (BFR)** nul signifie que les emplois d'exploitation sont exactement couverts par les ressources d'exploitation. Bien que neutre, cela demande une **gestion tr√®s fine** car le moindre d√©calage (ex: un impr√©vu sur les ventes ou les livraisons) peut rapidement g√©n√©rer un besoin de financement et des tensions de tr√©sorerie.`;
            bfrSolutions = `**Surveiller de pr√®s les flux d'exploitation** et chercher √† optimiser l√©g√®rement le BFR vers une valeur n√©gative ou faiblement positive et bien financ√©e par le FRNG pour assurer une marge de s√©curit√©.`;
        }
        addRatio("Besoin en Fonds de Roulement (BFR)", formatCurrency(calculations.bfr), bfrInterp, bfrSolutions);

        let tresorerieInterp, tresorerieSolutions;
        if (calculations.tresorerie > 0) {
            tresorerieInterp = `Une **Tr√©sorerie Nette (TN)** positive de ${formatCurrency(calculations.tresorerie)} d√©montre une **excellente capacit√©** de l'entreprise √† faire face √† ses obligations √† court terme. C'est le r√©sultat d'un Fonds de Roulement Net Global (FRNG) suffisant pour couvrir le Besoin en Fonds de Roulement (BFR). Une tr√©sorerie exc√©dentaire offre une **grande flexibilit√© financi√®re**, permettant des investissements opportuns, le remboursement anticip√© de dettes co√ªteuses, ou la distribution de dividendes.`;
            tresorerieSolutions = `**Allouer judicieusement cet exc√©dent :** envisager des investissements strat√©giques pour la croissance future, r√©duire les dettes financi√®res pour diminuer les charges d'int√©r√™ts, ou placer les fonds exc√©dentaires pour g√©n√©rer des revenus suppl√©mentaires. Il est important de ne pas laisser de liquidit√©s "dormir" sans objectif.`;
        } else if (calculations.tresorerie < 0) {
            tresorerieInterp = `Une **Tr√©sorerie Nette (TN)** n√©gative de ${formatCurrency(calculations.tresorerie)} est un **signal d'alarme important**, indiquant que l'entreprise est en situation de d√©couvert structurel ou qu'elle doit recourir √† des financements bancaires co√ªteux √† court terme (cr√©dits de tr√©sorerie). Cela survient lorsque le FRNG est insuffisant pour couvrir le BFR. C'est un **risque majeur de crise de liquidit√©** et de surco√ªts financiers.`;
            tresorerieSolutions = `**Mettre en place un plan de redressement imm√©diat :** r√©duire le BFR par une gestion agressive des stocks et des cr√©ances, augmenter le FRNG par des apports en capitaux propres ou des emprunts √† long terme, c√©der des actifs non strat√©giques, ou n√©gocier des lignes de cr√©dit √† court terme avec des conditions plus favorables.`;
        } else {
            tresorerieInterp = `Une **Tr√©sorerie Nette (TN)** nulle ou tr√®s faible signifie que l'entreprise n'a **pas de coussin de s√©curit√©** pour faire face aux impr√©vus ou aux variations de son cycle d'exploitation. Elle vit "√† flux tendus", ce qui la rend vuln√©rable au moindre choc financier ou d√©calage de paiement.`;
            tresorerieSolutions = `**D√©velopper une strat√©gie proactive pour am√©liorer la tr√©sorerie nette** en optimisant simultan√©ment le FRNG et le BFR, afin de construire une r√©serve de liquidit√©s pour plus de s√©r√©nit√© et de flexibilit√©.`;
        }
        addRatio("Tr√©sorerie Nette (TN)", formatCurrency(calculations.tresorerie), tresorerieInterp, tresorerieSolutions);
        currentPage++;

        // --- Page 3: Operational Ratios ---
        doc.addPage();
        addHeader("2. Ratios d'Exploitation");

        let bfreCaInterp, bfreCaSolutions;
        if (calculations.bfreCa < 5 && calculations.bfreCa >= 0) {
            bfreCaInterp = `Un ratio **BFRE / Chiffre d'Affaires** de ${formatPercent(calculations.bfreCa)}% est **excellent**. Il indique une gestion tr√®s efficace du besoin en fonds de roulement op√©rationnel par rapport au volume d'activit√© de l'entreprise. Cela signifie que l'entreprise n'immobilise que tr√®s peu de capitaux pour son cycle d'exploitation, voire g√©n√®re des liquidit√©s directement par ses op√©rations courantes.`;
            bfreCaSolutions = `**Maintenir cette performance** en surveillant constamment les d√©lais de rotation et les conditions commerciales. Partager les bonnes pratiques en interne et explorer comment cette efficacit√© peut √™tre un avantage concurrentiel.`;
        } else if (calculations.bfreCa >= 5 && calculations.bfreCa < 15) {
            bfreCaInterp = `Un ratio **BFRE / Chiffre d'Affaires** de ${formatPercent(calculations.bfreCa)}% est **acceptable**. Le besoin en fonds de roulement est sous contr√¥le par rapport au volume d'affaires, mais des **optimisations sont possibles** pour lib√©rer davantage de liquidit√©s qui pourraient √™tre r√©investies ou am√©liorer la tr√©sorerie.`;
            bfreCaSolutions = `**Identifier les leviers d'am√©lioration sp√©cifiques :** cela peut inclure une l√©g√®re r√©duction des niveaux de stocks, une acc√©l√©ration des d√©lais de paiement clients, ou la n√©gociation de meilleurs d√©lais fournisseurs. Un audit des processus d'exploitation est recommand√©.`;
        } else if (calculations.bfreCa >= 15) {
            bfreCaInterp = `Un ratio **BFRE / Chiffre d'Affaires** de ${formatPercent(calculations.bfreCa)}% est **√©lev√©**. Cela sugg√®re que l'entreprise a un besoin important en fonds de roulement par rapport √† son chiffre d'affaires, ce qui exerce une **pression significative sur sa tr√©sorerie**. Les causes peuvent √™tre des stocks excessifs, des cr√©ances clients difficiles √† recouvrer, ou des d√©lais fournisseurs trop courts.`;
            bfreCaSolutions = `**Urgent :** Mettre en ≈ìuvre des actions cibl√©es sur chaque composante du BFRE (stocks, clients, fournisseurs) pour le r√©duire significativement. **Revoir en profondeur les processus internes** et les politiques commerciales. Un objectif clair de r√©duction progressive de ce ratio doit √™tre √©tabli.`;
        } else { // Negative BFRE/CA
            bfreCaInterp = `Un ratio **BFRE / Chiffre d'Affaires** n√©gatif de ${formatPercent(calculations.bfreCa)}% est un **signe tr√®s favorable**, indiquant que le cycle d'exploitation de l'entreprise g√©n√®re des ressources de mani√®re structurelle et contribue positivement √† sa tr√©sorerie.`;
            bfreCaSolutions = `**Consolider cette performance** et l'utiliser comme un avantage comp√©titif. Documenter les pratiques qui m√®nent √† ce r√©sultat pour assurer leur p√©rennit√©.`;
        }
        addRatio("BFRE / Chiffre d'Affaires", formatPercent(calculations.bfreCa), bfreCaInterp, bfreCaSolutions);

        let delaiStocksInterp, delaiStocksSolutions;
        if (calculations.delaiStocks < 30) {
            delaiStocksInterp = `Un **D√©lai de Rotation des Stocks** de ${formatDays(calculations.delaiStocks)} est **excellent**. Cela indique une gestion tr√®s efficace des stocks, minimisant les co√ªts de stockage, le risque d'obsolescence, et l'immobilisation des capitaux. Les produits sont rapidement transform√©s et vendus, ce qui est tr√®s positif pour la tr√©sorerie.`;
            delaiStocksSolutions = `**Maintenir ces pratiques de gestion "juste-√†-temps"** et continuer √† optimiser les cha√Ænes d'approvisionnement. Explorer des technologies avanc√©es de gestion des stocks (RFID, IA pour la pr√©vision) pour encore plus d'efficacit√©.`;
        } else if (calculations.delaiStocks >= 30 && calculations.delaiStocks < 90) {
            delaiStocksInterp = `Un **D√©lai de Rotation des Stocks** de ${formatDays(calculations.delaiStocks)} est **acceptable**. La gestion des stocks est raisonnable, mais il pourrait y avoir des **opportunit√©s d'optimisation** pour r√©duire les capitaux immobilis√©s et les co√ªts associ√©s au stockage.`;
            delaiStocksSolutions = `**Analyser les causes de stockage prolong√©** pour certains articles (demande fluctuante, achats en gros). Envisager des syst√®mes de gestion des stocks plus avanc√©s (MRP, KanBan) ou des promotions sur les articles √† rotation lente pour les √©couler plus rapidement.`;
        } else {
            delaiStocksInterp = `Un **D√©lai de Rotation des Stocks** de ${formatDays(calculations.delaiStocks)} est **trop long**. Cela indique une immobilisation significative de capitaux dans les stocks, augmentant les co√ªts de possession (stockage, assurance, obsolescence, d√©pr√©ciation) et le risque de pertes. Cela peut aussi signaler des probl√®mes de pr√©vision des ventes ou de surproduction.`;
            delaiStocksSolutions = `**Urgent : R√©duire les niveaux de stock** par une meilleure pr√©vision des ventes, une gestion optimis√©e des commandes fournisseurs, et l'√©limination des stocks morts ou √† faible rotation. Mettre en place des indicateurs de performance cl√©s pour le suivi des stocks.`;
        }
        addRatio("D√©lai de Rotation des Stocks", formatDays(calculations.delaiStocks), delaiStocksInterp, delaiStocksSolutions);

        let delaiClientsInterp, delaiClientsSolutions;
        if (calculations.delaiClients < 45) {
            delaiClientsInterp = `Un **D√©lai Clients** de ${formatDays(calculations.delaiClients)} est **tr√®s bon**. Cela signifie que l'entreprise recouvre rapidement ses cr√©ances clients, ce qui est **tr√®s positif pour la tr√©sorerie**. C'est un signe de politiques de cr√©dit efficaces, de clients solvables, et d'un processus de facturation et de recouvrement performant.`;
            delaiClientsSolutions = `**Continuer √† surveiller les conditions de paiement** et la solvabilit√© des clients. Envisager des m√©canismes d'escompte pour paiement anticip√© si ce n'est pas d√©j√† le cas, pour encourager encore plus de rapidit√©.`;
        } else if (calculations.delaiClients >= 45 && calculations.delaiClients < 90) {
            delaiClientsInterp = `Un **D√©lai Clients** de ${formatDays(calculations.delaiClients)} est **raisonnable**. La p√©riode de recouvrement est dans une fourchette acceptable, mais des **am√©liorations pourraient optimiser davantage la tr√©sorerie** et r√©duire le besoin en fonds de roulement.`;
            delaiClientsSolutions = `**Renforcer les proc√©dures de relance** (automatis√©es si possible), proposer des facilit√©s de paiement structur√©es, et revoir les termes de cr√©dit pour les nouveaux clients ou les clients √† risque. √âvaluer l'efficacit√© du service client dans la r√©solution des litiges.`;
        } else {
            delaiClientsInterp = `Un **D√©lai Clients** de ${formatDays(calculations.delaiClients)} est **trop long**. Cela indique que l'entreprise a des difficult√©s √† recouvrer ses cr√©ances, ce qui **immobilise une part importante de ses fonds** et peut g√©n√©rer des tensions de tr√©sorerie. Les causes peuvent √™tre des politiques de cr√©dit trop souples, des litiges clients, ou un manque de suivi.`;
            delaiClientsSolutions = `**Urgent :** **Revoir et durcir les politiques de cr√©dit** accord√©es aux clients. Mettre en place un suivi rigoureux des retards de paiement, utiliser des outils de recouvrement (logiciels d√©di√©s, soci√©t√©s de recouvrement), et consid√©rer l'affacturage pour les cr√©ances importantes afin de convertir rapidement les factures en liquidit√©s.`;
        }
        addRatio("D√©lai Clients", formatDays(calculations.delaiClients), delaiClientsInterp, delaiClientsSolutions);

        let delaiFournisseursInterp, delaiFournisseursSolutions;
        if (calculations.delaiFournisseurs > 60) {
            delaiFournisseursInterp = `Un **D√©lai Fournisseurs** de ${formatDays(calculations.delaiFournisseurs)} est **tr√®s avantageux**. L'entreprise b√©n√©ficie de d√©lais de paiement longs de la part de ses fournisseurs, ce qui lui permet de **conserver ses liquidit√©s plus longtemps** et de les utiliser pour ses op√©rations ou investissements avant de payer. C'est une source de financement gratuite importante qui r√©duit le besoin en fonds de roulement.`;
            delaiFournisseursSolutions = `**Maintenir d'excellentes relations avec les fournisseurs cl√©s** pour pr√©server et, si possible, √©tendre ces conditions avantageuses. Explorer la possibilit√© d'obtenir des d√©lais similaires avec d'autres fournisseurs lors des n√©gociations de contrats.`;
        } else if (calculations.delaiFournisseurs >= 30 && calculations.delaiFournisseurs <= 60) {
            delaiFournisseursInterp = `Un **D√©lai Fournisseurs** de ${formatDays(calculations.delaiFournisseurs)} est **√©quilibr√© et conforme aux pratiques de march√©**. Il offre un financement correct sans cr√©er de d√©pendance excessive ou de risques pour la relation fournisseur.`;
            delaiFournisseursSolutions = `**Continuer √† n√©gocier des conditions favorables** en fonction du volume d'achat et de la relation. √âvaluer les offres de paiement anticip√© avec escompte si cela est financi√®rement avantageux pour l'entreprise (comparer l'escompte au co√ªt du financement).`;
        } else {
            delaiFournisseursInterp = `Un **D√©lai Fournisseurs** de ${formatDays(calculations.delaiFournisseurs)} est **trop court**. Cela exerce une **pression significative sur la tr√©sorerie** de l'entreprise car elle doit r√©gler ses achats rapidement. Cela peut √™tre d√ª √† une faible capacit√© de n√©gociation, √† la nature du secteur d'activit√©, ou √† la position dominante de certains fournisseurs.`;
            delaiFournisseursSolutions = `**N√©gocier activement avec les fournisseurs** pour obtenir des d√©lais de paiement plus longs. Chercher de nouveaux fournisseurs offrant des conditions plus flexibles. Am√©liorer la gestion des achats et le volume de commandes pour **renforcer le pouvoir de n√©gociation** de l'entreprise.`;
        }
        addRatio("D√©lai Fournisseurs", formatDays(calculations.delaiFournisseurs), delaiFournisseursInterp, delaiFournisseursSolutions);
        currentPage++;

        // --- Page 4: Solvency Ratios ---
        doc.addPage();
        addHeader("3. Ratios de Solvabilit√©");

        let autonomieInterp, autonomieSolutions;
        if (calculations.autonomie > 50) {
            autonomieInterp = `Une **Autonomie Financi√®re** de ${formatPercent(calculations.autonomie)}% est **solide et tr√®s rassurante**. Cela signifie que plus de la moiti√© des ressources de l'entreprise sont financ√©es par ses propres capitaux (capitaux propres), r√©duisant fortement la d√©pendance vis-√†-vis des dettes externes. C'est un gage de **stabilit√©, de faible risque financier**, et d'une grande capacit√© √† faire face aux chocs √©conomiques.`;
            autonomieSolutions = `**Continuer √† consolider les capitaux propres** par une politique de r√©tention des b√©n√©fices. Cette forte autonomie permet d'acc√©der plus facilement et √† de meilleures conditions aux financements externes si n√©cessaire, et renforce la cr√©dibilit√© aupr√®s des partenaires.`;
        } else if (calculations.autonomie >= 30 && calculations.autonomie <= 50) {
            autonomieInterp = `Une **Autonomie Financi√®re** de ${formatPercent(calculations.autonomie)}% est **acceptable**. L'entreprise pr√©sente un √©quilibre raisonnable entre les fonds propres et les dettes. Elle est en mesure de faire face √† ses engagements, mais une **am√©lioration renforcerait sa structure financi√®re** et sa r√©silience.`;
            autonomieSolutions = `**Veiller √† ce que l'endettement ne croisse pas plus vite que les capitaux propres.** Privil√©gier l'autofinancement des investissements ou les augmentations de capital pour renforcer progressivement cette autonomie financi√®re et diminuer le risque.`;
        } else {
            autonomieInterp = `Une **Autonomie Financi√®re** de ${formatPercent(calculations.autonomie)}% est **faible, voire pr√©occupante**. L'entreprise est fortement d√©pendante de l'endettement pour financer ses actifs. Cela la rend **vuln√©rable aux fluctuations de taux d'int√©r√™t**, aux difficult√©s de remboursement en cas de baisse d'activit√©, et augmente significativement le risque financier.`;
            autonomieSolutions = `**Urgent :** **Renforcer les capitaux propres** par des apports externes (nouvelle √©mission d'actions) ou une politique agressive de non-distribution des b√©n√©fices. **R√©duire l'endettement** en privil√©giant le remboursement des dettes co√ªteuses et en limitant les nouveaux emprunts jusqu'√† ce que le ratio s'am√©liore.`;
        }
        addRatio("Autonomie Financi√®re", formatPercent(calculations.autonomie), autonomieInterp, autonomieSolutions);

        let couvertureDettesInterp, couvertureDettesSolutions;
        if (calculations.couvertureDettes < 150) { // Typically good if below 200-300%
            couvertureDettesInterp = `Un ratio de **Couverture des Dettes Financi√®res (Dettes Financi√®res / EBE)** de ${formatPercent(calculations.couvertureDettes)}% est **tr√®s favorable**. Cela indique que l'Exc√©dent Brut d'Exploitation (EBE) est amplement suffisant pour couvrir les dettes financi√®res, montrant une **excellente capacit√© de remboursement de la dette** par les flux d'exploitation g√©n√©r√©s. C'est un signe de faible risque pour les cr√©anciers.`;
            couvertureDettesSolutions = `**Maintenir une g√©n√©ration d'EBE solide**. L'entreprise peut envisager d'optimiser sa structure de dette pour r√©duire les charges financi√®res sans impacter n√©gativement sa capacit√© de remboursement, ou utiliser cette capacit√© pour financer de nouveaux projets.`;
        } else if (calculations.couvertureDettes >= 150 && calculations.couvertureDettes < 300) {
            couvertureDettesInterp = `Un ratio de **Couverture des Dettes Financi√®res (Dettes Financi√®res / EBE)** de ${formatPercent(calculations.couvertureDettes)}% est **acceptable**. L'EBE permet de couvrir les dettes, mais une **surveillance est n√©cessaire**, surtout si l'EBE venait √† diminuer ou si de nouvelles dettes √©taient contract√©es. Le risque est g√©rable mais demande de la prudence.`;
            couvertureDettesSolutions = `**Surveiller attentivement l'√©volution de l'EBE** et des dettes financi√®res. Envisager de r√©duire les dettes si l'EBE montre des signes de stagnation ou de d√©clin pour conserver une marge de s√©curit√©.`;
        } else {
            couvertureDettesInterp = `Un ratio de **Couverture des Dettes Financi√®res (Dettes Financi√®res / EBE)** de ${formatPercent(calculations.couvertureDettes)}% est **√©lev√© et potentiellement dangereux**. Cela signifie que l'EBE n'est pas suffisant, ou juste suffisant, pour couvrir les dettes financi√®res, indiquant une charge de dette potentiellement trop lourde par rapport √† la capacit√© d'exploitation de l'entreprise. Le **risque de d√©faut de paiement** est accru.`;
            couvertureDettesSolutions = `**Urgent :** **R√©duire drastiquement le niveau d'endettement financier**, soit par remboursement (si la tr√©sorerie le permet), soit par ren√©gociation des termes de la dette (taux, √©ch√©ancier) avec les banques. Parall√®lement, mettre en place des actions pour **am√©liorer la g√©n√©ration d'EBE** par l'optimisation des co√ªts d'exploitation et l'augmentation des revenus.`;
        }
        addRatio("Couverture des Dettes Financi√®res (Dette Fin. / EBE)", formatPercent(calculations.couvertureDettes), couvertureDettesInterp, couvertureDettesSolutions);
        currentPage++;

        // --- Page 5: Liquidity Ratios ---
        doc.addPage();
        addHeader("4. Ratios de Liquidit√©");

        let liquiditeGeneraleInterp, liquiditeGeneraleSolutions;
        if (calculations.liquiditeGenerale > 1.8) {
            liquiditeGeneraleInterp = `Une **Liquidit√© G√©n√©rale (Current Ratio)** de ${calculations.liquiditeGenerale.toFixed(2)} est **excellente**. Cela signifie que l'actif circulant (stocks, cr√©ances, tr√©sorerie) couvre amplement le passif circulant (dettes √† court terme). L'entreprise a une **tr√®s forte capacit√© √† honorer ses dettes √† court terme**, offrant une grande s√©curit√© et flexibilit√© op√©rationnelle.`;
            liquiditeGeneraleSolutions = `**Maintenir cette position de liquidit√© saine.** Cependant, il est important d'√©valuer si un exc√®s de liquidit√© n'est pas "endormi" (ex: trop de tr√©sorerie inactive ou de stocks pl√©thoriques) et si ces fonds pourraient √™tre mieux employ√©s (investissements strat√©giques, remboursements de dette √† co√ªt √©lev√©).`;
        } else if (calculations.liquiditeGenerale >= 1.2 && calculations.liquiditeGenerale <= 1.8) {
            liquiditeGeneraleInterp = `Une **Liquidit√© G√©n√©rale (Current Ratio)** de ${calculations.liquiditeGenerale.toFixed(2)} est **bonne et g√©n√©ralement consid√©r√©e comme saine**. L'actif circulant est suffisant pour couvrir le passif circulant, assurant une bonne capacit√© de remboursement des dettes √† court terme. C'est une position √©quilibr√©e qui offre une s√©curit√© raisonnable.`;
            liquiditeGeneraleSolutions = `**Surveiller l'√©volution des composants du cycle d'exploitation** (stocks, cr√©ances, dettes fournisseurs). S'assurer que le niveau de liquidit√© reste ad√©quat face aux besoins futurs et aux √©ventuelles fluctuations de l'activit√©.`;
        } else {
            liquiditeGeneraleInterp = `Une **Liquidit√© G√©n√©rale (Current Ratio)** de ${calculations.liquiditeGenerale.toFixed(2)} est **faible, voire insuffisante**. L'actif circulant est insuffisant pour couvrir le passif circulant, ce qui signale un **risque de liquidit√© √©lev√©** et de potentielles difficult√©s √† honorer les dettes √† court terme √† leur √©ch√©ance. L'entreprise pourrait √™tre en situation de tension de tr√©sorerie.`;
            liquiditeGeneraleSolutions = `**Urgent :** **Am√©liorer la gestion du BFR** (r√©duire les stocks, acc√©l√©rer les cr√©ances, allonger les dettes fournisseurs). Rechercher des **financements √† long terme** pour couvrir les besoins structurels et √©viter de financer le long terme par du court terme. Un plan de tr√©sorerie d√©taill√© est indispensable.`;
        }
        addRatio("Liquidit√© G√©n√©rale (Current Ratio)", calculations.liquiditeGenerale.toFixed(2), liquiditeGeneraleInterp, liquiditeGeneraleSolutions);

        let liquiditeReduiteInterp, liquiditeReduiteSolutions;
        if (calculations.liquiditeReduite > 1) {
            liquiditeReduiteInterp = `Une **Liquidit√© R√©duite (Quick Ratio)** de ${calculations.liquiditeReduite.toFixed(2)} est **tr√®s bonne**. Cela signifie que, sans compter les stocks (qui sont les actifs circulants les moins liquides car leur vente n'est pas garantie √† court terme), l'entreprise peut largement faire face √† ses dettes √† court terme. Cela indique une **forte capacit√© √† g√©n√©rer du cash rapidement** si n√©cessaire.`;
            liquiditeReduiteSolutions = `**Continuer √† maintenir une composition saine des actifs circulants**, en privil√©giant les √©l√©ments les plus liquides (tr√©sorerie, cr√©ances clients). Cette position offre une grande flexibilit√© en cas de besoin impr√©vu de liquidit√©s.`;
        } else if (calculations.liquiditeReduite >= 0.7 && calculations.liquiditeReduite <= 1) {
            liquiditeReduiteInterp = `Une **Liquidit√© R√©duite (Quick Ratio)** de ${calculations.liquiditeReduite.toFixed(2)} est **acceptable**. L'entreprise peut g√©n√©ralement honorer ses dettes √† court terme sans d√©pendre de la vente rapide de ses stocks. Cela sugg√®re une gestion √©quilibr√©e des liquidit√©s hors stocks.`;
            liquiditeReduiteSolutions = `**Surveiller attentivement le niveau des cr√©ances clients et de la tr√©sorerie disponible.** S'assurer que les flux de tr√©sorerie op√©rationnels sont suffisants pour couvrir les besoins quotidiens sans puiser dans les stocks.`;
        } else {
            liquiditeReduiteInterp = `Une **Liquidit√© R√©duite (Quick Ratio)** de ${calculations.liquiditeReduite.toFixed(2)} est **faible et pr√©occupante**. L'entreprise pourrait avoir du mal √† honorer ses dettes √† court terme sans devoir vendre rapidement ses stocks, ce qui n'est pas toujours r√©alisable ou optimal (risque de brader les prix). Cela indique une **forte d√©pendance aux stocks pour assurer la liquidit√©**.`;
            liquiditeReduiteSolutions = `**Urgent :** **R√©duire les stocks dormants** ou √† faible rotation, **am√©liorer drastiquement le recouvrement des cr√©ances clients**, et **augmenter la tr√©sorerie disponible** par d'autres moyens (ex: obtention de lignes de cr√©dit confirm√©es, r√©duction des d√©penses non essentielles).`;
        }
        addRatio("Liquidit√© R√©duite (Quick Ratio)", calculations.liquiditeReduite.toFixed(2), liquiditeReduiteInterp, liquiditeReduiteSolutions);
        currentPage++;

        // --- Page 6: Profitability Ratios ---
        doc.addPage();
        addHeader("5. Ratios de Rentabilit√©");

        let roaInterp, roaSolutions;
        if (calculations.roa > 12) {
            roaInterp = `Un **ROA (Return on Assets)** de ${formatPercent(calculations.roa)}% est **excellent**. Il d√©montre une **grande efficacit√© de l'entreprise √† g√©n√©rer du profit √† partir de l'ensemble de ses actifs** (immobilisations et actifs circulants). C'est un indicateur cl√© de la performance op√©rationnelle et de la capacit√© de l'entreprise √† utiliser ses ressources pour cr√©er de la richesse.`;
            roaSolutions = `**Maintenir une utilisation optimale des actifs** et continuer √† identifier des opportunit√©s d'am√©lioration de la productivit√©. Envisager des investissements qui augmentent le ROA en am√©liorant l'efficacit√© et la rentabilit√©.`;
        } else if (calculations.roa >= 5 && calculations.roa <= 12) {
            roaInterp = `Un **ROA (Return on Assets)** de ${formatPercent(calculations.roa)}% est **acceptable**. La rentabilit√© des actifs est correcte, mais il pourrait y avoir des **opportunit√©s d'optimisation** pour am√©liorer encore l'efficacit√© de l'utilisation des ressources et d√©gager plus de profits.`;
            roaSolutions = `**Analyser l'utilisation de chaque cat√©gorie d'actifs** (mat√©riel, stocks, cr√©ances). Chercher √† r√©duire les co√ªts op√©rationnels et augmenter les revenus sans augmenter proportionnellement les actifs. La digitalisation et l'automatisation peuvent √™tre des leviers.`;
        } else {
            roaInterp = `Un **ROA (Return on Assets)** de ${formatPercent(calculations.roa)}% est **faible et pr√©occupant**. L'entreprise ne g√©n√®re pas suffisamment de profit par rapport √† la taille de ses actifs. Cela peut indiquer une **sous-utilisation des actifs**, des co√ªts op√©rationnels trop √©lev√©s, une strat√©gie de prix inefficace, ou des investissements non rentables.`;
            roaSolutions = `**R√©√©valuer en profondeur la strat√©gie d'investissement et de production.** Optimiser l'utilisation des capacit√©s de production, identifier et c√©der les actifs improductifs, et am√©liorer la marge op√©rationnelle en contr√¥lant les co√ªts et en ajustant les prix.`;
        }
        addRatio("ROA (Rentabilit√© √âconomique)", formatPercent(calculations.roa), roaInterp, roaSolutions);

        let roeInterp, roeSolutions;
        if (calculations.roe > 18) {
            roeInterp = `Un **ROE (Return on Equity)** de ${formatPercent(calculations.roe)}% est **tr√®s attrayant et excellent**. Il indique que l'entreprise g√©n√®re un rendement exceptionnel pour ses actionnaires, d√©montrant l'**efficacit√© avec laquelle elle utilise les capitaux propres pour g√©n√©rer des profits nets**. C'est un signe de forte cr√©ation de valeur pour les propri√©taires.`;
            roeSolutions = `**Poursuivre la croissance rentable** et maintenir une saine structure financi√®re pour continuer √† cr√©er de la valeur pour les actionnaires. Communiquer cette performance aux investisseurs pour attirer de nouveaux capitaux si n√©cessaire.`;
        } else if (calculations.roe >= 8 && calculations.roe <= 18) {
            roeInterp = `Un **ROE (Return on Equity)** de ${formatPercent(calculations.roe)}% est **bon et satisfaisant**. Le rendement pour les actionnaires est solide, indiquant une gestion efficace des capitaux propres pour g√©n√©rer du profit. C'est un niveau qui attire g√©n√©ralement les investisseurs.`;
            roeSolutions = `**Continuer √† optimiser la rentabilit√© nette et la structure de capital.** Comparer ce ratio aux concurrents du secteur pour √©valuer la performance relative et identifier des marges de progression.`;
        } else {
            roeInterp = `Un **ROE (Return on Equity)** de ${formatPercent(calculations.roe)}% est **faible et potentiellement d√©courageant pour les investisseurs**. Le rendement g√©n√©r√© par les capitaux propres est insuffisant. Cela peut √™tre d√ª √† une faible rentabilit√© op√©rationnelle, √† des charges financi√®res √©lev√©es, ou √† un endettement excessif qui p√®se sur le r√©sultat net.`;
            roeSolutions = `**Urgent :** **Augmenter la profitabilit√© nette** par des r√©ductions de co√ªts, une augmentation des ventes, et/ou une optimisation de la structure financi√®re (ex: r√©duction des charges financi√®res). Si l'endettement est la cause, envisager un d√©sendettement ou une augmentation de capital.`;
        }
        addRatio("ROE (Rentabilit√© Financi√®re)", formatPercent(calculations.roe), roeInterp, roeSolutions);
        currentPage++;

        // --- Page 7: Income Statement Ratios (Growth and Margins) ---
        doc.addPage();
        addHeader("6. Ratios du Compte de R√©sultat");

        let croissanceCAInterp, croissanceCASolutions;
        if (calculations.croissanceCA > 5) {
            croissanceCAInterp = `Une **Croissance du Chiffre d'Affaires** de ${formatPercent(calculations.croissanceCA)}% est **robuste et tr√®s positive**. C'est un signe de vitalit√© du march√©, de la capacit√© de l'entreprise √† conqu√©rir ou maintenir ses parts, et de la pertinence de son offre. Une croissance des ventes est souvent le moteur de la cr√©ation de valeur.`;
            croissanceCASolutions = `**Capitaliser sur cette dynamique de croissance** en explorant de nouveaux march√©s, en lan√ßant de nouveaux produits/services, ou en renfor√ßant la strat√©gie commerciale. Il est crucial de **surveiller la rentabilit√© associ√©e √† cette croissance** pour s'assurer qu'elle n'est pas "√† tout prix".`;
        } else if (calculations.croissanceCA >= 0 && calculations.croissanceCA <= 5) {
            croissanceCAInterp = `Une **Croissance du Chiffre d'Affaires** de ${formatPercent(calculations.croissanceCA)}% est **mod√©r√©e ou stable**. L'entreprise maintient son niveau d'activit√©, mais la croissance est limit√©e, ce qui peut signaler un march√© mature ou une absence de nouveaux leviers de d√©veloppement.`;
            croissanceCASolutions = `**Rechercher des leviers de croissance additionnels** : innovation produit/service, expansion g√©ographique, diversification des offres, ou intensification des efforts marketing et commerciaux pour stimuler les ventes.`;
        } else {
            croissanceCAInterp = `Une **Croissance du Chiffre d'Affaires** de ${formatPercent(calculations.croissanceCA)}% est **n√©gative**. Le chiffre d'affaires diminue, ce qui est **pr√©occupant** et peut indiquer une perte de parts de march√©, une demande en baisse pour les produits/services de l'entreprise, une concurrence accrue, ou des probl√®mes de positionnement.`;
            croissanceCASolutions = `**Urgent :** **Analyser en profondeur les causes de cette baisse** (strat√©gie commerciale, qualit√© des produits, environnement macro-√©conomique, satisfaction client). D√©velopper un **plan de relance des ventes et de marketing agressif**. Envisager une restructuration de l'offre si n√©cessaire.`;
        }
        addRatio("Croissance du Chiffre d'Affaires", formatPercent(calculations.croissanceCA), croissanceCAInterp, croissanceCASolutions);

        let margeBruteInterp, margeBruteSolutions;
        if (calculations.margeBrute > 25) {
            margeBruteInterp = `Une **Marge Brute** de ${formatPercent(calculations.margeBrute)}% est **tr√®s bonne et indique une forte rentabilit√© des ventes** apr√®s d√©duction du co√ªt des marchandises vendues. L'entreprise a un excellent contr√¥le sur ses co√ªts directs de production ou d'achat, ou un bon pouvoir de fixation des prix sur le march√©.`;
            margeBruteSolutions = `**Maintenir les strat√©gies d'approvisionnement et de prix.** Chercher des opportunit√©s d'am√©lioration de l'efficacit√© de la production et de la cha√Æne d'approvisionnement pour pr√©server ou augmenter cette marge d√©j√† performante.`;
        } else if (calculations.margeBrute >= 10 && calculations.margeBrute <= 25) {
            margeBruteInterp = `Une **Marge Brute** de ${formatPercent(calculations.margeBrute)}% est **acceptable et permet de couvrir les charges fixes**, mais des **optimisations sont possibles** pour am√©liorer le r√©sultat net. La marge est dans une fourchette raisonnable pour le secteur.`;
            margeBruteSolutions = `**Analyser la structure des co√ªts des achats ou de production.** N√©gocier de meilleures conditions avec les fournisseurs, optimiser les processus de fabrication pour r√©duire les co√ªts variables, ou revoir la strat√©gie de prix si le march√© le permet.`;
        } else {
            margeBruteInterp = `Une **Marge Brute** de ${formatPercent(calculations.margeBrute)}% est **faible et pr√©occupante**. Cela signifie que le co√ªt des marchandises vendues est trop √©lev√© par rapport aux revenus g√©n√©r√©s par les ventes, ce qui **impacte directement la rentabilit√© globale de l'entreprise** et limite sa capacit√© √† couvrir ses charges d'exploitation.`;
            margeBruteSolutions = `**Urgent :** **R√©viser la politique d'achat** (rechercher de nouveaux fournisseurs, n√©gocier les volumes, optimiser la logistique), **optimiser les processus de production** pour r√©duire les gaspillages et les co√ªts variables, ou **revoir la strat√©gie de prix** de vente si la valeur per√ßue par le client le justifie.`;
        }
        addRatio("Marge Brute (R√©sultat d'Exercice / CA)", formatPercent(calculations.margeBrute), margeBruteInterp, margeBruteSolutions);

        let tauxResultatNetInterp, tauxResultatNetSolutions;
        if (calculations.tauxResultatNet > 8) {
            tauxResultatNetInterp = `Un **Taux de R√©sultat Net (R√©sultat d'Exercice / CA)** de ${formatPercent(calculations.tauxResultatNet)}% est **excellent**. L'entreprise est **tr√®s efficace √† transformer son chiffre d'affaires en profit net**, apr√®s d√©duction de toutes les charges (op√©rationnelles, financi√®res, imp√¥ts). C'est un indicateur global de performance et de cr√©ation de valeur pour les actionnaires.`;
            tauxResultatNetSolutions = `**Capitaliser sur cette forte rentabilit√©.** √âvaluer les opportunit√©s d'investissement ou de distribution de dividendes. Continuer √† surveiller toutes les lignes de co√ªts pour maintenir cette performance.`;
        } else if (calculations.tauxResultatNet >= 2 && calculations.tauxResultatNet <= 8) {
            tauxResultatNetInterp = `Un **Taux de R√©sultat Net (R√©sultat d'Exercice / CA)** de ${formatPercent(calculations.tauxResultatNet)}% est **acceptable**. Le profit net est raisonnable par rapport aux ventes, mais des **efforts peuvent √™tre faits pour am√©liorer cette proportion** et augmenter la cr√©ation de valeur.`;
            tauxResultatNetSolutions = `**Examiner toutes les lignes de co√ªts et de revenus** pour identifier des pistes d'am√©lioration, depuis l'optimisation des charges d'exploitation jusqu'√† la r√©duction des charges financi√®res et une gestion fiscale efficace.`;
        } else {
            tauxResultatNetInterp = `Un **Taux de R√©sultat Net (R√©sultat d'Exercice / CA)** de ${formatPercent(calculations.tauxResultatNet)}% est **faible, voire n√©gatif**. Cela indique que l'entreprise a du mal √† g√©n√©rer un profit significatif par rapport √† ses ventes, ou qu'elle est en perte sur l'exercice. Cela peut √™tre le r√©sultat de faibles marges brutes, de co√ªts d'exploitation √©lev√©s, ou de charges financi√®res/fiscales importantes.`;
            tauxResultatNetSolutions = `**Urgent :** **Revoir l'ensemble de la structure de co√ªts**, la strat√©gie de prix et les sources de revenus. Identifier les "trous" dans le compte de r√©sultat et prendre des mesures correctives pour **redresser la rentabilit√© nette**.`;
        }
        addRatio("Taux de R√©sultat Net (R√©sultat d'Exercice / CA)", formatPercent(calculations.tauxResultatNet), tauxResultatNetInterp, tauxResultatNetSolutions);
        currentPage++;

        // --- Page 8: Value Added Ratios ---
        doc.addPage();
        addHeader("7. Ratios de Valeur Ajout√©e (R√©partition)");

        addRatio(
            "Part du Personnel dans la VA",
            formatPercent(calculations.partPersonnel),
            `Ce ratio de ${formatPercent(calculations.partPersonnel)}% mesure la proportion de la **Valeur Ajout√©e (VA)** qui est distribu√©e au personnel sous forme de salaires, charges sociales et autres avantages. Un ratio **trop √©lev√©** peut indiquer une productivit√© faible par employ√©, une masse salariale trop importante par rapport √† la richesse cr√©√©e, ou une entreprise de service tr√®s intensive en main d'≈ìuvre. Un ratio **trop faible** pourrait signaler des salaires peu comp√©titifs ou une forte automatisation du processus.`,
            "**Optimiser la productivit√© du personnel** par des formations, l'adoption de nouvelles technologies ou des outils plus performants. **Comparer ce ratio avec les entreprises du m√™me secteur** pour √©valuer la comp√©titivit√© et la structure des co√ªts. Si le ratio est tr√®s √©lev√© et non justifi√©, envisager une restructuration des co√ªts de personnel."
        );

        addRatio(
            "Part de l'√âtat dans la VA",
            formatPercent(calculations.partEtat),
            `Ce ratio de ${formatPercent(calculations.partEtat)}% repr√©sente la part de la **Valeur Ajout√©e (VA)** pr√©lev√©e par l'√âtat sous forme d'imp√¥ts, taxes et pr√©l√®vements obligatoires. Il refl√®te directement la **pression fiscale** sur l'entreprise et la contribution de l'entreprise aux finances publiques.`,
            "**S'assurer de l'optimisation fiscale** dans le cadre l√©gal en vigueur. Identifier les cr√©dits d'imp√¥ts, les subventions ou les avantages fiscaux auxquels l'entreprise pourrait pr√©tendre pour r√©duire cette charge sans nuire √† la conformit√©."
        );

        addRatio(
            "Part de l'Entreprise dans la VA (EBE / VA)",
            formatPercent(calculations.partEntreprise),
            `Ce ratio de ${formatPercent(calculations.partEntreprise)}% indique la part de la **Valeur Ajout√©e (VA)** qui reste √† l'entreprise pour financer ses amortissements, ses charges financi√®res, et son r√©sultat net. C'est un indicateur de la **capacit√© de l'entreprise √† g√©n√©rer un exc√©dent brut d'exploitation (EBE)** √† partir de la richesse qu'elle a cr√©√©e. Une part √©lev√©e est g√©n√©ralement tr√®s souhaitable.`,
            "**Augmenter l'efficacit√© op√©rationnelle et la productivit√©** pour maximiser l'EBE. G√©rer efficacement les co√ªts de production, les d√©penses g√©n√©rales et les prix de vente pour am√©liorer cette part de la richesse qui revient directement √† l'entreprise pour sa croissance et sa p√©rennit√©."
        );

        addRatio(
            "Part des Amortissements dans l'EBE",
            formatPercent(calculations.partImmo),
            `Ce ratio de ${formatPercent(calculations.partImmo)}% montre la part de l'**Exc√©dent Brut d'Exploitation (EBE)** absorb√©e par la dotation aux amortissements, qui repr√©sente l'usure et la d√©pr√©ciation des immobilisations (√©quipements, b√¢timents). Un ratio **√©lev√©** peut indiquer un parc d'immobilisations important, des investissements r√©cents et lourds, ou une politique d'amortissement agressive.`,
            "**√âvaluer la pertinence et la rentabilit√© des investissements pass√©s.** S'assurer que les immobilisations g√©n√®rent suffisamment d'EBE pour couvrir leur d√©pr√©ciation. Planifier judicieusement les futurs investissements en tenant compte de leur impact sur cet indicateur."
        );

        addRatio(
            "Part des Charges Financi√®res dans l'EBE",
            formatPercent(calculations.partFinancier),
            `Ce ratio de ${formatPercent(calculations.partFinancier)}% indique la proportion de l'**Exc√©dent Brut d'Exploitation (EBE)** consacr√©e au paiement des charges financi√®res (principalement les int√©r√™ts sur les dettes). Un ratio **√©lev√©** est un signe de forte d√©pendance √† l'endettement et de charges financi√®res lourdes, ce qui **r√©duit la capacit√© de l'entreprise √† investir** dans son activit√© principale ou √† distribuer des dividendes.`,
            "**R√©duire l'endettement financier**, si possible, par un remboursement anticip√© ou une optimisation de la tr√©sorerie. **Ren√©gocier les taux d'int√©r√™t** ou les conditions d'emprunt avec les banques. Chercher des sources de financement moins co√ªteuses pour diminuer cette charge et lib√©rer de l'EBE pour d'autres usages strat√©giques."
        );
        currentPage++;

        // --- Page 9: CAF Ratios ---
        doc.addPage();
        addHeader("8. Capacit√© d'Autofinancement");

        addRatio(
            "Capacit√© d'Autofinancement (CAF)",
            formatCurrency(calculations.caf),
            `La **Capacit√© d'Autofinancement (CAF)** de ${formatCurrency(calculations.caf)} est un flux de tr√©sorerie interne essentiel g√©n√©r√© par l'activit√© op√©rationnelle de l'entreprise. C'est une **ressource fondamentale** pour financer les investissements, rembourser les dettes ou distribuer des dividendes sans avoir recours √† des financements externes (emprunts ou augmentation de capital). Une CAF √©lev√©e est un signe de **bonne sant√© financi√®re et d'autonomie**.`,
            "**Maintenir ou augmenter la CAF** en am√©liorant la rentabilit√© op√©rationnelle (accro√Ætre les revenus, r√©duire les co√ªts) et en optimisant la gestion des charges. **Utiliser la CAF de mani√®re strat√©gique** pour renforcer la structure financi√®re, financer la croissance, ou am√©liorer la r√©mun√©ration des actionnaires."
        );

        addRatio(
            "Autofinancement",
            formatCurrency(calculations.autofinancement),
            `L'**Autofinancement** de ${formatCurrency(calculations.autofinancement)} repr√©sente la part de la CAF qui reste dans l'entreprise apr√®s la distribution des dividendes aux actionnaires. C'est la portion de richesse interne que l'entreprise conserve pour **financer sa croissance future, ses investissements, ou r√©duire son endettement**. Un autofinancement positif et suffisant est crucial pour l'ind√©pendance financi√®re et la p√©rennit√© de l'entreprise.`,
            "**√âquilibrer la politique de distribution de dividendes avec les besoins de financement internes.** Pour une entreprise en croissance, privil√©gier un autofinancement √©lev√© est souvent une strat√©gie saine pour √©viter un endettement excessif et assurer le d√©veloppement futur."
        );

        let capaciteEndettementInterp, capaciteEndettementSolutions;
        if (calculations.capaciteEndettement < 3) {
            capaciteEndettementInterp = `Une **Capacit√© d'Endettement (Dettes Financi√®res / CAF)** de ${calculations.capaciteEndettement.toFixed(2)} est **tr√®s bonne et rassurante**. Cela signifie que l'entreprise peut rembourser l'ensemble de ses dettes financi√®res avec sa CAF en moins de ${calculations.capaciteEndettement.toFixed(1)} ans. C'est un ratio **extr√™mement favorable pour les banquiers** et un indicateur de faible risque d'insolvabilit√©, indiquant une forte capacit√© de d√©sendettement.`;
            capaciteEndettementSolutions = `**Maintenir un niveau de dette coh√©rent avec la g√©n√©ration de CAF.** Cette excellente capacit√© permet √† l'entreprise d'envisager de nouveaux emprunts pour des projets de croissance strat√©giques avec des conditions tr√®s favorables, si l'opportunit√© se pr√©sente.`;
        } else if (calculations.capaciteEndettement >= 3 && calculations.capaciteEndettement < 5) {
            capaciteEndettementInterp = `Une **Capacit√© d'Endettement (Dettes Financi√®res / CAF)** de ${calculations.capaciteEndettement.toFixed(2)} est **acceptable**. Le remboursement des dettes par la CAF prendra environ ${calculations.capaciteEndettement.toFixed(1)} ans. C'est g√©rable, mais une **attention est n√©cessaire** si la CAF venait √† diminuer ou si l'endettement augmentait significativement.`;
            capaciteEndettementSolutions = `**Surveiller le niveau de l'endettement et la p√©rennit√© de la CAF.** R√©duire progressivement la dette ou mettre en place des actions pour augmenter la CAF afin d'am√©liorer ce ratio et se pr√©munir contre d'√©ventuels revers.`;
        } else {
            capaciteEndettementInterp = `Une **Capacit√© d'Endettement (Dettes Financi√®res / CAF)** de ${calculations.capaciteEndettement.toFixed(2)} est **√©lev√©e et pr√©occupante**. L'entreprise prendrait plus de ${calculations.capaciteEndettement.toFixed(1)} ans pour rembourser ses dettes financi√®res avec sa CAF actuelle. Cela indique un **endettement potentiellement trop lourd** par rapport √† sa capacit√© de g√©n√©ration de flux, augmentant le risque financier et la difficult√© d'obtenir de nouveaux financements.`;
            capaciteEndettementSolutions = `**Urgent :** **Mettre en place un plan de d√©sendettement** (remboursement anticip√©, restructuration de la dette avec des dur√©es plus longues) ou des actions pour **augmenter significativement la CAF** (am√©lioration de la rentabilit√©, optimisation du BFR). L'objectif est de ramener ce ratio √† un niveau plus soutenable.`;
        }
        addRatio("Capacit√© d'Endettement (Dettes Financi√®res / CAF)", calculations.capaciteEndettement.toFixed(2), capaciteEndettementInterp, capaciteEndettementSolutions);
        currentPage++;

        // --- Page 10: Final Synthesis --- (Adjusted from Page 9 to avoid conflicting page numbers in the code)
        doc.addPage();
        addHeader("9. Synth√®se Finale et Recommandations Strat√©giques");

        yPos = 35; // Reset yPos for this page

        doc.setFont(undefined, 'bold');
        doc.text("Points Forts Majeurs :", 20, yPos);
        yPos += 8;
        doc.setFont(undefined, 'normal');
        const strengths = [
            `‚Ä¢ **Tr√©sorerie nette positive (${formatCurrency(calculations.tresorerie)})** : L'entreprise dispose d'une excellente liquidit√©, offrant flexibilit√© et s√©curit√© pour ses op√©rations courantes et impr√©vus.`,
            `‚Ä¢ **FRNG exc√©dentaire (${formatCurrency(calculations.frng)})** : La structure financi√®re est solide, avec des ressources √† long terme couvrant amplement les besoins d'investissement et une partie du BFR.`,
            `‚Ä¢ **Rotation des stocks (${formatDays(calculations.delaiStocks)}) et D√©lai Clients (${formatDays(calculations.delaiClients)}) efficaces** : T√©moigne d'une gestion op√©rationnelle performante et d'un recouvrement rapide des cr√©ances.`,
            `‚Ä¢ **Forte autonomie financi√®re (${formatPercent(calculations.autonomie)})** : L'ind√©pendance vis-√†-vis des cr√©anciers est √©lev√©e, gage de stabilit√©, de r√©silience et d'un risque financier ma√Ætris√©.`,
            `‚Ä¢ **Bonne capacit√© d'autofinancement (${formatCurrency(calculations.caf)})** : L'entreprise g√©n√®re suffisamment de flux de tr√©sorerie interne pour financer sa croissance et rembourser ses dettes sans d√©pendre excessivement de l'ext√©rieur.`
        ];
        strengths.forEach(item => {
            const lines = doc.splitTextToSize(item, 175);
            doc.text(lines, 25, yPos);
            yPos += lines.length * 7;
        });
        yPos += 5;

        doc.setFont(undefined, 'bold');
        doc.text("Points de Vigilance et Faiblesses Potentielles :", 20, yPos);
        yPos += 8;
        doc.setFont(undefined, 'normal');
        const weaknesses = [
            `‚Ä¢ **Rentabilit√© √©conomique (ROA : ${formatPercent(calculations.roa)})** : Bien que pr√©sente, elle n√©cessite une optimisation de l'utilisation de l'ensemble des actifs pour g√©n√©rer un profit plus √©lev√© par rapport aux ressources engag√©es.`,
            `‚Ä¢ **Marge Brute (${formatPercent(calculations.margeBrute)})** : Si elle n'est pas au top du secteur, une revue des co√ªts de production/achats pourrait significativement l'am√©liorer.`,
            `‚Ä¢ **D√©lai Fournisseurs (${formatDays(calculations.delaiFournisseurs)})** : Des d√©lais courts peuvent exercer une pression sur la tr√©sorerie et limitent l'avantage du financement spontan√© des fournisseurs.`,
            `‚Ä¢ **Part des charges financi√®res dans l'EBE (${formatPercent(calculations.partFinancier)})** : Un niveau non n√©gligeable de charges financi√®res indique un co√ªt de la dette qui impacte la capacit√© √† g√©n√©rer du r√©sultat net.`
        ];
        weaknesses.forEach(item => {
            const lines = doc.splitTextToSize(item, 175);
            doc.text(lines, 25, yPos);
            yPos += lines.length * 7;
        });
        yPos += 5;

        doc.setFont(undefined, 'bold');
        doc.text("Plan d'Action Strat√©gique Prioritaire :", 20, yPos);
        yPos += 8;
        doc.setFont(undefined, 'normal');
        const recommendations = [
            "1. **Optimisation de la rentabilit√© des actifs :** Mener une revue approfondie de l'efficacit√© de chaque cat√©gorie d'actifs pour am√©liorer le ROA. Cela peut inclure la cession d'actifs sous-performants, l'investissement dans des technologies plus efficientes, ou une meilleure gestion des stocks et cr√©ances.",
            "2. **Gestion proactive des co√ªts et des marges :** Analyser en d√©tail la structure des co√ªts (production, exploitation, financiers) pour identifier les opportunit√©s de r√©duction sans compromettre la qualit√©. N√©gocier activement avec les fournisseurs pour allonger les d√©lais de paiement et am√©liorer la marge brute.",
            "3. **Renforcement continu de la structure financi√®re :** Continuer √† privil√©gier l'autofinancement pour consolider les capitaux propres et, si n√©cessaire, r√©√©valuer la structure de la dette pour r√©duire les charges financi√®res.",
            "4. **Acc√©l√©ration du cycle d'exploitation :** Bien que d√©j√† efficaces, poursuivre les efforts pour r√©duire les d√©lais de rotation des stocks et des cr√©ances clients, tout en cherchant √† optimiser les d√©lais fournisseurs pour lib√©rer davantage de liquidit√©s.",
            "5. **Plan de croissance strat√©gique :** D√©velopper des initiatives pour stimuler la croissance du chiffre d'affaires tout en ma√Ætrisant les co√ªts associ√©s, afin d'am√©liorer la rentabilit√© globale et la g√©n√©ration de CAF, assurant une cr√©ation de valeur durable."
        ];
        recommendations.forEach(item => {
            const lines = doc.splitTextToSize(item, 175);
            doc.text(lines, 25, yPos);
            yPos += lines.length * 7;
        });
        yPos += 10;

        // Conclusion
        const conclusion = "En conclusion, la Soci√©t√© XYZ pr√©sente une base financi√®re tr√®s saine, caract√©ris√©e par une excellente liquidit√©, une solide autonomie financi√®re et une bonne capacit√© d'autofinancement. Cependant, des efforts cibl√©s sur l'optimisation de la rentabilit√© des actifs et une gestion encore plus fine des co√ªts op√©rationnels et financiers sont essentiels pour soutenir une croissance durable et maximiser la cr√©ation de valeur pour l'ensemble des parties prenantes. Une vigilance continue sur le BFR et la dette permettra de maintenir cette stabilit√© financi√®re dans un environnement √©conomique en constante √©volution.";
        const conclusionLines = doc.splitTextToSize(conclusion, 175); // Adjusted width
        doc.text(conclusionLines, 20, yPos);

        // Add page numbers to all pages
        const finalPageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= finalPageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(10);
            doc.text(`Page ${i}/${finalPageCount}`, 105, 290, null, null, 'center'); // Adjusted y position
        }

        doc.save(`rapport-financier-${companyName}-${date.replace(/\//g, '-')}.pdf`);
    }

    document.getElementById('submitBtn2').addEventListener('click', generateDetailedFinancialReport);
});
</script>
<script>
  // Utility to parse "1 234,56 DA" or "1.234,56" to float
  function parseNumber(value) {
    if (!value) return 0;
    return parseFloat(
      value.replace(/\s/g, '')     // remove spaces
           .replace(/,/g, '.')     // replace comma with dot
           .replace(/[^\d.-]/g, '') // remove non-numeric except dot/hyphen
    ) || 0;
  }

  // Utility to format to French-style number with comma
  function formatNumber(value) {
    return new Intl.NumberFormat('fr-FR', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(value) + ' DA';
  }

  function updateCalculations() {
    const positifFields = [
      'excedent_brut',
      'produit_exploitation',
      'produits_financiers',
      'produits_exceptionnels'
    ];

    const negatifFields = [
      'charge_exploitation_neg',
      'charges_financieres_neg',
      'charges_exceptionnelles_neg',
      'participations_salaries_neg',
      'impots_benefices_neg'
    ];

    let totalPositif = 0;
    let totalNegatif = 0;

    positifFields.forEach(id => {
      const input = document.getElementById(id);
      if (input) totalPositif += parseNumber(input.value);
    });

    negatifFields.forEach(id => {
      const input = document.getElementById(id);
      if (input) totalNegatif += parseNumber(input.value);
    });

    const totalCap = totalPositif - totalNegatif;

    document.getElementById('total_positif').textContent = formatNumber(totalPositif);
    document.getElementById('total_negatif').textContent = formatNumber(totalNegatif);
    document.getElementById('total_cap').textContent = formatNumber(totalCap);
  }

  // Add listener to all text inputs
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('input[type="text"]').forEach(input => {
      input.addEventListener('input', updateCalculations);
    });

    // First update in case values are pre-filled
    updateCalculations();
  });
</script>






    <!-- Add this button to your HTML -->

</body>

</html>